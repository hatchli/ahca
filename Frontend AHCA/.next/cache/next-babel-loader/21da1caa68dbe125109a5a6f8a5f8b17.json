{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  mutation UPDATE_PHONE_LOCATION(\\n    $name: String\\n    $location: String\\n    $phone: String\\n    $email: String\\n  ) {\\n    updatePhoneLocation(\\n      name: $name\\n      location: $location\\n      phone: $phone\\n      email: $email\\n    ) {\\n      id\\n    }\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { Component } from \"react\";\nimport { Mutation } from \"react-apollo\";\nimport gql from \"graphql-tag\";\nimport MapGL, { LinearInterpolator, GeolocateControl } from \"react-map-gl\";\nimport WebMercatorViewport from \"viewport-mercator-project\";\nimport bbox from \"@turf/bbox\";\nimport ControlPanel from \"./ControlPanel\";\nimport MAP_STYLE from \"./styles/MapStyles\";\nimport { Box, Flex } from \"rebass\"; // import MAP_STYLE from 'https://api.mapbox.com/styles/v1/mapbox/light-v9.html?title=false&access_token=pk.eyJ1IjoibXNsZWUiLCJhIjoiclpiTWV5SSJ9.P_h8r37vD8jpIH1A6i1VRg#7.75/33.997/-116.72'\n\nimport LocationCard from \"./LocationCard\";\nvar TOKEN = process.env.MAP_PASS; // Set your mapbox token here\n\nvar geolocateStyle = {\n  position: \"absolute\",\n  top: 0,\n  left: 0,\n  margin: 10\n};\nvar UPDATE_PHONE_LOCATION = gql(_templateObject());\n\nvar Map =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Map, _Component);\n\n  function Map(props) {\n    var _this;\n\n    _classCallCheck(this, Map);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Map).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"_updateViewport\", function (viewport) {\n      _this.setState({\n        viewport: viewport\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_onClick\", function (event) {\n      var countyName = \"\";\n      var clickInfo = null;\n      var county = event.features[0];\n      var feature = event.features[0];\n\n      if (county) {\n        clickInfo = {\n          lngLat: event.lngLat,\n          county: county.properties\n        };\n        countyName = clickInfo.county.name;\n      }\n\n      if (feature) {\n        // calculate the bounding box of the feature\n        var _bbox = bbox(feature),\n            _bbox2 = _slicedToArray(_bbox, 4),\n            minLng = _bbox2[0],\n            minLat = _bbox2[1],\n            maxLng = _bbox2[2],\n            maxLat = _bbox2[3]; // construct a viewport instance from the current state\n\n\n        var viewport = new WebMercatorViewport(_this.state.viewport);\n\n        var _viewport$fitBounds = viewport.fitBounds([[minLng, minLat], [maxLng, maxLat]], {\n          padding: 40\n        }),\n            longitude = _viewport$fitBounds.longitude,\n            latitude = _viewport$fitBounds.latitude,\n            zoom = _viewport$fitBounds.zoom;\n\n        console.log(zoom);\n\n        _this.setState({\n          county: countyName,\n          clickInfo: clickInfo,\n          viewport: _objectSpread({}, _this.state.viewport, {\n            longitude: longitude,\n            latitude: latitude,\n            zoom: zoom,\n            transitionInterpolator: new LinearInterpolator({\n              around: [event.offsetCenter.x, event.offsetCenter.y]\n            }),\n            transitionDuration: 1000\n          })\n        });\n      }\n    });\n\n    _this.state = {\n      county: \"Select Your Location on the Map!\",\n      viewport: {\n        latitude: 34.0537,\n        longitude: -118.243,\n        zoom: 7,\n        bearing: 0,\n        pitch: 0\n      },\n      popupInfo: null,\n      clickInfo: null\n    };\n    _this._map = React.createRef();\n    return _this;\n  }\n\n  _createClass(Map, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var viewport = this.state.viewport;\n      var clickInfo = this.state.clickInfo;\n      var county = this.state.county;\n      var minZoom = 6;\n      return __jsx(Mutation, {\n        mutation: UPDATE_PHONE_LOCATION,\n        variables: this.state\n      }, function (updatePhoneLocation, _ref) {\n        var loading = _ref.loading,\n            error = _ref.error;\n        return __jsx(Flex, {\n          flexWrap: \"wrap\"\n        }, __jsx(Box, {\n          width: [1, 1, 1 / 2],\n          minHeight: \"300px\",\n          minWidth: \"300px\"\n        }, __jsx(MapGL, _extends({\n          ref: _this2._map,\n          mapStyle: MAP_STYLE,\n          interactiveLayerIds: [\"sf-neighborhoods-fill\"]\n        }, viewport, {\n          width: \"100%\",\n          height: \"100%\",\n          minZoom: minZoom,\n          minHeight: \"1vh\",\n          minWidth: \"1vh\",\n          onClick: _this2._onClick,\n          county: county // countyInfo={}\n          ,\n          onViewportChange: _this2._updateViewport,\n          mapboxApiAccessToken: TOKEN,\n          onTransitionEnd: function _callee() {\n            var res;\n            return _regeneratorRuntime.async(function _callee$(_context) {\n              while (1) {\n                switch (_context.prev = _context.next) {\n                  case 0:\n                    console.log(\"onchange called\");\n                    _context.next = 3;\n                    return _regeneratorRuntime.awrap(updatePhoneLocation());\n\n                  case 3:\n                    res = _context.sent;\n                    console.log(res);\n\n                  case 5:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }\n            });\n          }\n        }), __jsx(ControlPanel, {\n          containerComponent: _this2.props.containerComponent\n        }), __jsx(GeolocateControl, {\n          style: geolocateStyle,\n          positionOptions: {\n            enableHighAccuracy: true\n          },\n          trackUserLocation: true\n        }))), __jsx(Box, {\n          px: 3,\n          width: [1, 1, 1 / 2]\n        }, __jsx(LocationCard, {\n          county: county\n        })));\n      });\n    }\n  }]);\n\n  return Map;\n}(Component);\n\nexport { Map as default };","map":null,"metadata":{},"sourceType":"module"}