{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _Array$from from \"@babel/runtime-corejs2/core-js/array/from\";\nimport _parseFloat from \"@babel/runtime-corejs2/core-js/parse-float\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  mutation CREATE_ITEM_MUTATION(\\n    $title: String!\\n    $description: String!\\n    $features: [String!]\\n    $highlights: [String!]\\n    $sale: Boolean\\n    $categories: [Category]\\n    $price: Int!\\n    $promo: [ValidPromoCodes]\\n    $image: String\\n    $largeImage: String\\n    $image1: String\\n    $largeImage1: String\\n    $image2: String\\n    $largeImage2: String\\n  ) {\\n    createItem(\\n      title: $title\\n      description: $description\\n      features: $features\\n      highlights: $highlights\\n      sale: $sale\\n      categories: $categories\\n      price: $price\\n      promo: $promo\\n      image: $image\\n      largeImage: $largeImage\\n      image1: $image1\\n      largeImage1: $largeImage1\\n      image2: $image2\\n      largeImage2: $largeImage2\\n    ) {\\n      id\\n    }\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { Component } from \"react\";\nimport { Box, Flex } from \"rebass\";\nimport { Mutation } from \"react-apollo\";\nimport gql from \"graphql-tag\";\nimport Router from \"next/router\";\nimport Form from \"./styles/Form\";\nimport Error from \"./ErrorMessage\";\nimport WidthStyles from \"./styles/WidthStyles\";\nvar possibleCategories = [\"AIRCONDITIONER\", \"FURNACE\", \"WHOLEHOMEMANIFOLD\", \"TANKLESSWATERSYSTEM\", \"WATERSOFTENER\", \"WATERFILTRATION\", \"PLUMBING\", \"HEATPUMP\", \"DUCTLESSMINISPLIT\"];\nvar promoCodes = [\"LACOUNTY2020\", \"SFCOUNTY2020\"];\nvar CREATE_ITEM_MUTATION = gql(_templateObject());\n\nvar CreateItem =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(CreateItem, _Component);\n\n  function CreateItem() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, CreateItem);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(CreateItem)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      title: \"\",\n      description: \"\",\n      features: [\"\"],\n      highlights: [\"\"],\n      sale: false,\n      categories: \"\",\n      imageArray: [],\n      largeImageArray: [],\n      image: \"\",\n      largeImage: \"\",\n      image1: \"\",\n      largeImage1: \"\",\n      image2: \"\",\n      largeImage2: \"\",\n      price: 0,\n      promo: []\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleChange\", function (e) {\n      console.log(\"value: \", e.target.value);\n      console.log(\"name: \", e.target.name);\n      var _e$target = e.target,\n          name = _e$target.name,\n          type = _e$target.type,\n          value = _e$target.value;\n      var val = type === \"number\" ? _parseFloat(value) : value;\n      console.log(\"name: \", name, \"val: \", val);\n\n      _this.setState(_defineProperty({}, name, val));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleFeatureArrayChange\", function (e) {\n      var _e$target2 = e.target,\n          name = _e$target2.name,\n          type = _e$target2.type,\n          value = _e$target2.value;\n\n      _this.setState(function (prevState) {\n        return {\n          features: prevState.features.map(function (feat, key) {\n            if (key == name) {\n              return value;\n            } else return feat;\n          })\n        };\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleHighlightArrayChange\", function (e) {\n      var _e$target3 = e.target,\n          name = _e$target3.name,\n          type = _e$target3.type,\n          value = _e$target3.value;\n\n      _this.setState(function (prevState) {\n        return {\n          highlights: prevState.highlights.map(function (highlight, key) {\n            if (key == name) {\n              return value;\n            } else return highlight;\n          })\n        };\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"keyPressFeature\", function (e) {\n      if (e.keyCode == 13) {\n        _this.setState({\n          features: _this.state.features.concat(\"\")\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"keyPressHighlight\", function (e) {\n      if (e.keyCode == 13) {\n        _this.setState({\n          highlights: _this.state.highlights.concat(\"\")\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleArrayChange\", function (e) {\n      _this.setState({\n        promo: _Array$from(e.target.selectedOptions, function (item) {\n          return item.value;\n        })\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"uploadFileHandler\", function _callee2(e) {\n      var files, data;\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              console.log(\"... uploading\");\n              files = e.target.files;\n              data = new FormData();\n\n              _Array$from(files).map(function _callee(file) {\n                var res, fileResp;\n                return _regeneratorRuntime.async(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        data.append(\"file\", file);\n                        data.append(\"upload_preset\", \"americansavings\");\n                        _context.next = 4;\n                        return _regeneratorRuntime.awrap(fetch(\"https://api.cloudinary.com/v1_1/americansavings/image/upload\", {\n                          method: \"POST\",\n                          body: data\n                        }));\n\n                      case 4:\n                        res = _context.sent;\n                        _context.next = 7;\n                        return _regeneratorRuntime.awrap(res.json());\n\n                      case 7:\n                        fileResp = _context.sent;\n                        console.log(\"fileResp\", fileResp);\n\n                        if (!fileResp.error) {\n                          _this.setState(function (prevState) {\n                            return _objectSpread({}, prevState, {\n                              imageArray: [].concat(_toConsumableArray(prevState.imageArray), [fileResp.secure_url]),\n                              largeImageArray: [].concat(_toConsumableArray(prevState.largeImageArray), [fileResp.eager[0].secure_url])\n                            });\n                          });\n                        } else {\n                          _this.setState(function (prevState) {\n                            return _objectSpread({}, prevState, {\n                              imageArray: _toConsumableArray(prevState.image),\n                              largeImageArray: _toConsumableArray(prevState.largeImage)\n                            });\n                          });\n                        }\n\n                      case 10:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                });\n              });\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(CreateItem, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      var _this2 = this;\n\n      console.log(\"prevState\", prevState.imageArray);\n      console.log(\"state of imageArray\", this.state.imageArray);\n\n      if (this.state.imageArray !== prevState.imageArray) {\n        this.setState(function (prevState) {\n          return _objectSpread({}, prevState, {\n            image: _this2.state.imageArray[0],\n            largeImage: _this2.state.largeImageArray[0],\n            image1: _this2.state.imageArray[1],\n            largeImage1: _this2.state.largeImageArray[1],\n            image2: _this2.state.imageArray[2],\n            largeImage2: _this2.state.largeImageArray[2]\n          });\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return __jsx(WidthStyles, null, __jsx(Mutation, {\n        mutation: CREATE_ITEM_MUTATION,\n        variables: this.state\n      }, function (createItem, _ref) {\n        var loading = _ref.loading,\n            error = _ref.error;\n        return __jsx(Form, {\n          \"data-test\": \"form\",\n          onSubmit: function _callee3(e) {\n            var res;\n            return _regeneratorRuntime.async(function _callee3$(_context3) {\n              while (1) {\n                switch (_context3.prev = _context3.next) {\n                  case 0:\n                    // Stop the form from submitting\n                    e.preventDefault();\n                    _context3.next = 3;\n                    return _regeneratorRuntime.awrap(createItem());\n\n                  case 3:\n                    res = _context3.sent;\n                    // change them to the single item page\n                    console.log(res);\n                    Router.push({\n                      pathname: \"/item\",\n                      query: {\n                        id: res.data.createItem.id\n                      }\n                    });\n\n                  case 6:\n                  case \"end\":\n                    return _context3.stop();\n                }\n              }\n            });\n          }\n        }, __jsx(Error, {\n          error: error\n        }), __jsx(\"fieldset\", {\n          disabled: loading,\n          \"aria-busy\": loading\n        }, __jsx(Flex, {\n          px: 2,\n          justifyContent: \"space-between\"\n        }, __jsx(\"label\", {\n          htmlFor: \"file\"\n        }, \"Images\", __jsx(\"input\", {\n          multiple: true,\n          type: \"file\",\n          id: \"file\",\n          name: \"file\",\n          placeholder: \"Upload an image\",\n          required: true,\n          onChange: _this3.uploadFileHandler\n        }))), __jsx(\"label\", {\n          htmlFor: \"title\"\n        }, \"Title\", __jsx(\"input\", {\n          type: \"text\",\n          id: \"title\",\n          name: \"title\",\n          placeholder: \"Title\",\n          required: true,\n          value: _this3.state.title,\n          onChange: _this3.handleChange\n        })), __jsx(\"label\", {\n          htmlFor: \"price\"\n        }, \"Price\", __jsx(\"input\", {\n          type: \"number\",\n          id: \"price\",\n          name: \"price\",\n          placeholder: \"Price\",\n          required: true,\n          value: _this3.state.price,\n          onChange: _this3.handleChange\n        })), __jsx(\"label\", {\n          htmlFor: \"sale\"\n        }, \"Sale\", __jsx(\"input\", {\n          type: \"checkbox\",\n          id: \"sale\",\n          name: \"sale\",\n          value: _this3.state.sale,\n          onChange: function onChange() {\n            _this3.setState({\n              sale: !_this3.state.value\n            });\n          }\n        })), __jsx(\"label\", {\n          htmlFor: \"categories\"\n        }, \"Category\", __jsx(\"select\", {\n          value: _this3.state.categories,\n          name: \"categories\",\n          id: \"categories\",\n          onChange: _this3.handleChange,\n          multiple: false\n        }, possibleCategories.map(function (category) {\n          return __jsx(\"option\", {\n            key: category,\n            value: category\n          }, category);\n        }))), __jsx(\"label\", {\n          htmlFor: \"categories\"\n        }, \"Promo\", __jsx(\"select\", {\n          value: _this3.state.promo,\n          name: \"promo\",\n          id: \"promo\" // type=\"array\"\n          ,\n          onChange: _this3.handleArrayChange,\n          multiple: true\n        }, promoCodes.map(function (promo) {\n          return __jsx(\"option\", {\n            key: promo.id,\n            value: promo\n          }, promo);\n        }))), __jsx(\"label\", {\n          htmlFor: \"description\"\n        }, \"Description\", __jsx(\"textarea\", {\n          id: \"description\",\n          name: \"description\",\n          placeholder: \"Enter A Description\",\n          required: true,\n          value: _this3.state.description,\n          onChange: _this3.handleChange\n        })), __jsx(\"label\", {\n          htmlFor: \"features\"\n        }, \"Features\", _this3.state.features.map(function (feature, i) {\n          return __jsx(\"div\", {\n            key: i\n          }, __jsx(\"textarea\", {\n            key: i,\n            type: \"features\",\n            placeholder: \"\".concat(feature) // supply a unique \"name\" attribute using string interpolation\n            ,\n            name: i,\n            value: _this3.state.features[i],\n            onChange: _this3.handleFeatureArrayChange,\n            onKeyDown: _this3.keyPressFeature\n          }));\n        })), __jsx(\"label\", {\n          htmlFor: \"highlights\"\n        }, \"Highlights\", _this3.state.highlights.map(function (highlight, i) {\n          return __jsx(\"div\", {\n            key: i\n          }, __jsx(\"textarea\", {\n            key: i,\n            type: \"highlights\",\n            placeholder: \"\".concat(highlight) // supply a unique \"name\" attribute using string interpolation\n            ,\n            name: i,\n            value: _this3.state.highlights[i],\n            onChange: _this3.handleHighlightArrayChange,\n            onKeyDown: _this3.keyPressHighlight\n          }));\n        })), __jsx(\"button\", {\n          type: \"submit\"\n        }, \"Submit\")));\n      }));\n    }\n  }]);\n\n  return CreateItem;\n}(Component);\n\nexport default CreateItem;\nexport { CREATE_ITEM_MUTATION };","map":null,"metadata":{},"sourceType":"module"}